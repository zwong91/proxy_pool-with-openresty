FROM openresty/openresty:1.21.4.1-5-jammy

RUN sed -i "s/archive.ubuntu.com/mirrors.aliyun.com/g" /etc/apt/sources.list

WORKDIR /app

RUN opm get ledgetech/lua-resty-http && \
    opm get anjia0532/lua-resty-redis-util &&  \
    opm get hamishforbes/lua-resty-iputils

COPY tunnel .
RUN cat  conf/nginx.conf

ADD tunnel/lua /app/lua

CMD /bin/sh -c "mkdir -p /app/logs && cd /usr/local/openresty/nginx && openresty -p /app"
